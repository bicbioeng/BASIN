---
title: "BASIN Analysis Report"
subtitle: "`r reportTitle()`"
author: "`r reportAuthor()`"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
always_allow_html: yes
---
**Cite this analysis**: Tim Hartman. et al., BASIN- a workflow for objective statistical analysis of bio-image dataset, CSBJ, 2021
<br>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Contents
1. [Introduction](#introduction)
2. [Upload](#upload)
3. [Extraction & Pre-processing](#extraction)
4. [Analysis Results](#analysis-results)
5. [References](#references)
6. [Appendix A: Data Analysis Log](#appendix-a:-data-analysis-log)

# Introduction
```{r figure, echo=FALSE}
knitr::include_graphics(file.path(reportsDir,'www','figure1.png'))
```
<br>
<br>
The Bioinformatic Analysis, Statistic, and Image Comparison (BASIN) app extracts object feature data and statistics from fluorescent micrographs. The user uploads images plus a custom analysis table which contains image and experiment information. The user then chooses the desired threshold method for each color frame and runs the analyses for each image. BASIN runs the analyses and returns graphs and t-test results which the user may then incorporate in his or her paper.
<br>

# Upload
```{r images, warning=FALSE, echo = FALSE}
line1 <- values$imgsSource
HTML(paste(line1))
par(mfrow = c(1,2))
EBImage::display(values$img1, method = "raster", margin = c(50,30), spacing = 0)
text(x = values$img1@dim[1]/2, y = values$img1@dim[2]+15, label = input$img1Condition, cex = 1.25)
EBImage::display(values$img2, method = "raster", margin = c(50,30), spacing = 0)
text(x = values$img2@dim[1]/2, y = values$img2@dim[2]+15, label = input$img2Condition, cex = 1.25)

```

# Extraction
```{r extraction, warning=FALSE, echo=FALSE}
line1 <- paste0("1. Image frames were thresholded using the following methods: ", input$red.thresh.auto, " for ", input$imgsRedStain, " stain, ",
                   input$green.thresh.auto, " for ", input$imgsGreenStain, " stain, and ",
                   input$blue.thresh.auto, " for ", input$imgsBlueStain,  "stain.")
line2 <- paste("2. User chose the following alternate hypotheses:")
line3 <- paste0("  a. ", input$imgsRedStain, ": ", input$r.intensity.altHypothesis, " for mean intensity and ", input$r.area.altHypothesis, " for area")
line4 <- paste0("  b. ", input$imgsGreenStain, ": ", input$g.intensity.altHypothesis, " for mean intensity and ", input$g.area.altHypothesis, " for area")
line5 <- paste0("  c. ", input$imgsBlueStain, ": ", input$b.intensity.altHypothesis, " for mean intensity and ", input$b.area.altHypothesis, " for area") 
line6 <- paste("3. User chose to exclude from t-testing:")
line7 <- paste0("  a. ", input$imgsRedStain, " objects with area less than ", input$minMaxObjectArea.r[1], " and greater than ", input$minMaxObjectArea.r[2], " pixels ")
line8 <- paste0("  b. ", input$imgsGreenStain, " objects with area less than ", input$minMaxObjectArea.g[1], " and greater than ", input$minMaxObjectArea.g[2], " pixels ")
line9 <- paste0("  c. ", input$imgsBlueStain, " objects with area less than ", input$minMaxObjectArea.b[1], " and greater than ", input$minMaxObjectArea.b[2], " pixels ")
HTML(paste(line1, line2, line3, line4, line5, line6, line7, line8, line9, sep = '<br/>'))
```
<br>

<center> Image Extraction Sequences
```{r imgs, echo = FALSE, out.width="100%"}
par(mfrow = c(1,2))
# Image 1
blankSpot <- Image(matrix("white", dim(values$img1)[1], dim(values$img1)[2]))
    EBImage::display(
      EBImage::combine(
        blankSpot, values$img1, blankSpot,
        values$img1.r, values$img1.g, values$img1.b, 
        values$img1.r.th, values$img1.g.th, values$img1.b.th, 
        values$img1.r.clbl, values$img1.g.clbl, values$img1.b.clbl, 
        values$img1.r.pntd, values$img1.g.pntd, values$img1.b.pntd
      ), nx = 3, spacing = 10, margin = c(10,60), method = "raster", all = TRUE
    )
    text(x = (10 + dim(values$img1)[1] + dim(values$img1)[1]/2), y = -30, label = input$img1Condition, adj = c(0.5, 0), col = "black", cex = 1)
    text(x = -10, y = (10 + dim(values$img1)[2] + dim(values$img1)[2]/2), label = "Frame", adj = c(0.5, 0), col = "black", cex = 1, srt = 90)
    text(x = -10, y = (20 + 2*dim(values$img1)[2] + dim(values$img1)[2]/2), label = "Threshold", adj = c(0.5, 0), col = "black", cex = 1, srt = 90)
    text(x = -10, y = (30 + 3*dim(values$img1)[2] + dim(values$img1)[2]/2), label = "Label", adj = c(0.5, 0), col = "black", cex = 1, srt = 90)
    text(x = -10, y = (40 + 4*dim(values$img1)[2] + dim(values$img1)[2]/2), label = "Outline", adj = c(0.5, 0), col = "black", cex = 1, srt = 90)
    
# Image 2
blankSpot <- Image(matrix("white", dim(values$img2)[1], dim(values$img2)[2]))
    EBImage::display(
      EBImage::combine(
        blankSpot, values$img2, blankSpot,
        values$img2.r, values$img2.g, values$img2.b, 
        values$img2.r.th, values$img2.g.th, values$img2.b.th, 
        values$img2.r.clbl, values$img2.g.clbl, values$img2.b.clbl, 
        values$img2.r.pntd, values$img2.g.pntd, values$img2.b.pntd
      ), nx = 3, spacing = 10, margin = c(10,60), method = "raster", all = TRUE 
    )
    text(x = (10 + dim(values$img2)[1] + dim(values$img2)[1]/2), y = -30, label = input$img2Condition, adj = c(0.5, 0), col = "black", cex = 1)
    text(x = -10, y = (10 + dim(values$img2)[2] + dim(values$img2)[2]/2), label = "Frame", adj = c(0.5, 0), col = "black", cex = 1, srt = 90)
    text(x = -10, y = (20 + 2*dim(values$img2)[2] + dim(values$img2)[2]/2), label = "Threshold", adj = c(0.5, 0), col = "black", cex = 1, srt = 90)
    text(x = -10, y = (30 + 3*dim(values$img2)[2] + dim(values$img2)[2]/2), label = "Label", adj = c(0.5, 0), col = "black", cex = 1, srt = 90)
    text(x = -10, y = (40 + 4*dim(values$img2)[2] + dim(values$img2)[2]/2), label = "Outline", adj = c(0.5, 0), col = "black", cex = 1, srt = 90)
```
<br>

Raw Image Data
```{r plots, echo = FALSE, warning = FALSE, out.width = "100%"}
plot(barplot1())
plot(barplot2())
plot(boxplot1())
plot(boxplot2())
```
<br>
</center>

# Analysis Results
```{r difference analysis, echo = FALSE, warning = FALSE}
knitr::kable(values$differenceData, caption = paste('Table 1. Computed differences in net image intensity and object counts between', input$img1Condition, 'and', input$img2Condition, sep = " "))
```
```{r t-test analysis, echo = FALSE, warning = FALSE}
tTestDT()
plot(boxplot3())
plot(boxplot4())
```
<br>

# References
[1] Yihui Xie, Joe Cheng and Xianying Tan (2019). DT: A Wrapper of the 
JavaScript Library 'DataTables'. R package version 0.7. 
https://CRAN.R-project.org/package=DT
<br>
[2] Gregoire Pau, Florian Fuchs, Oleg Sklyar, Michael Boutros, and 
Wolfgang Huber (2010): EBImage - an R package for image processing with 
applications to cellular phenotypes. Bioinformatics, 26(7), pp. 979-981, 
10.1093/bioinformatics/btq046
<br>
[3] H. Wickham. ggplot2: Elegant Graphics for Data Analysis. 
Springer-Verlag New York, 2016. 
<br>
[4] Alboukadel Kassambara (2019). ggpubr: 'ggplot2' Based Publication 
Ready Plots. R package version 0.2.1. 
https://CRAN.R-project.org/package=ggpubr 
br>
"[5] Hadley Wickham (2011). The Split-Apply-Combine Strategy for Data 
Analysis. Journal of Statistical Software, 40(1), 1-29. URL 
http://www.jstatsoft.org/v40/i01/. 
<br>
[6] Winston Chang, Joe Cheng, JJ Allaire, Yihui Xie and Jonathan 
McPherson (2019). shiny: Web Application Framework for R. R package 
version 1.3.2. https://CRAN.R-project.org/package=shiny 
<br>
[7] Eric Bailey (2015). shinyBS: Twitter Bootstrap Components for 
Shiny. R package version 0.61. 
https://CRAN.R-project.org/package=shinyBS 
<br>
[8] Andras Sali (2017). shinycssloaders: Add CSS Loading Animations to 
'shiny' Outputs. R package version 0.2.0. 
https://CRAN.R-project.org/package=shinycssloaders 
<br>
[9] Winston Chang and Barbara Borges Ribeiro (2018). shinydashboard: 
Create Dashboards with 'Shiny'. R package version 0.7.1. 
https://CRAN.R-project.org/package=shinydashboard 
<br>
[10] Winston Chang (2018). shinythemes: Themes for Shiny. R package 
version 1.1.2. https://CRAN.R-project.org/package=shinythemes
<br>
[11] Victor Perrier, Fanny Meyer and David Granjon (2019). 
shinyWidgets: Custom Inputs Widgets for Shiny. R package version 0.4.9. 
https://CRAN.R-project.org/package=shinyWidgets
<br>
[12] Gagolewski M. and others (2019). R package stringi: Character 
string processing facilities. 
http://www.gagolewski.com/software/stringi/.
<br>
[13] Hadley Wickham (2007). Reshaping Data with the reshape Package. 
Journal of Statistical Software, 21(12), 1-20. URL
http://www.jstatsoft.org/v21/i12/.
<br>
[14] R Core Team (2019). R: A language and environment for statistical 
computing. R Foundation for Statistical Computing, Vienna, Austria. 
URL https://www.R-project.org/.
<br>
[15] Baptiste Auguie (2017). gridExtra: Miscellaneous Functions for 
'Grid' Graphics. R package version 2.3.
https://CRAN.R-project.org/package=gridExtra
<br>
```{r references, echo = FALSE}
if(input$thresh.auto == "IJDefault") {
      HTML(paste(
        "[16] Ridler TW, Calvard S. Picture thresholding using an 
        iterative selection method. <i>IEEE Transactions on Systems, Man, 
        and Cybernetics</i>. 1978;8:630-632. doi:10.1109/TSMC.1978.4310039"))
    } else if(input$thresh.auto == "Huang") {
      HTML(paste(
        "[16] Huang L-K, Wang M-JJ. Image thresholding by minimizing 
        the measure of fuzziness. <i>Pattern Recognition</i>. 1995;18(1):41-51. 
        doi:10.1016/0031-3203(94)E0043-K"))
    } else if(input$thresh.auto == "Huang2") {
      HTML(paste(
        "[16] Landini G. Auto threshold. ImageJ website. 
        https://imagej.net/Auto_Threshold#Default. April 29, 2017. Accessed 
        December 23, 2019."))
    } else if(input$thresh.auto == "Intermodes") {
      HTML(paste(
        "[16] Prewitt JMS, Mendelsohn ML. The analysis of cell images. 
        <i>Annals of the New York Academy of Sciences</i>. 
        1966;128:1035-1053."))
    } else if(input$thresh.auto == "IsoData") {
      HTML(paste(
        "[16] Ridler TW, Calvard S. Picture thresholding using an 
        iterative selection method. <i>IEEE Transactions on Systems, Man, 
        and Cybernetics</i>. 1978;8:630-632. doi:10.1109/TSMC.1978.4310039"))
    } else if(input$thresh.auto == "Li") {
      HTML(paste(
        "[16] Li CH, Tam PKS. An iterative algorithm for minimum cross 
        entropy thresholding. <i>Pattern Recognition Letters</i>. 1998;18(8):
        771-776. doi:10.1016/S0167-8655(98)00057-9"))
    } else if(input$thresh.auto == "MaxEntropy") {
      HTML(paste(
        "[16] Kapur JN, Sahoo PK, Wong ACK. A new method for gray-level 
        picture thresholding using the entropy of the histogram. <i>Graphical 
        Models and Image Processing</i>. 1985;29(3):273-285. doi:10.1016/0734-
        189X(85)90125-2"))
    } else if(input$thresh.auto == "Mean") {
      HTML(paste(
        "[16] Glasbey CA. An analysis of histogram-based thresholding 
        algorithms. <i>CVGIP: Graphical Models and Image Processing</i>. 
        1993;55:532-537. doi:10.1006/cgip.1993.1040"))
    } else if(input$thresh.auto == "MinErrorI") {
      HTML(paste(
        "[16] Kittler J, Illingworth J. Minimum error thresholding. 
        <i>Pattern Recognition</i>. 1986;19:41-47. doi:10.1016/0031-3203(86)
        90030-0"))
    } else if(input$thresh.auto == "Minimum") {
      HTML(paste(
        "[16] Prewitt JMS, Mendelsohn ML. The analysis of cell images. 
        <i>Annals of the New York Academy of Sciences</i>. 1966;128:1035-1053."
        ))
    } else if(input$thresh.auto == "Moments") {
      HTML(paste(
        "[16] Tsai W. Moment-preserving thresholding: a new approach. 
        <i>Computer Vision, Graphics, and Image Processing</i>. 1985;29:377-
        393."))
    } else if(input$thresh.auto == "Otsu") {
      HTML(paste(
        "[16] Otsu N. A threshold selection method from gray-level 
        histograms. <i>IEEE Transactions on Systems, Man, and Cybernetics</i>. 
        1979;9:62-66. doi:10.1109/TSMC.1979.4310076"))
    } else if(input$thresh.auto == "Percentile") {
      HTML(paste(
        "[16] Doyle W. Operation useful for similarity-invariant pattern 
        recognition. <i>Journal of the Association for Computing Machinery</i>. 
        1962;9:259-267. doi:10.1145/321119.321123"))
    } else if(input$thresh.auto == "RenyiEntropy") {
      HTML(paste(
        "[16] Kapur JN, Sahoo PK, Wong ACK. A new method for gray-level 
        picture thresholding using the entropy of the histogram. <i>CVGIP: 
        Graphical Models and Image Processing</i>. 1985;29(3):273-285. doi:10.
        1016/0734-189X(85)90125-2"))
    } else if(input$thresh.auto == "Shanbhag") {
      HTML(paste(
        "[16] Shanbhag AG. Utilization of information measure as a 
        means of image thresholding. <i>CVGIP: Graphical Models and Image 
        Processing</i>. 1994;56(5):414-419. doi:10.1006/cgip.1994.1037"))
    } else if(input$thresh.auto == "Triangle") {
      HTML(paste(
        "[16] Zack GW, Rogers WE, Latt SA. Automatic measurement 
        of sister chromatid exchange frequency. <i>Journal of Histochemistry 
        and Cytochemistry</i>. 1977;25(7):741-753. doi:10.1177/25.7.70454"))
    } else if(input$thresh.auto == "Yen") {
      line1 <- "[16] Yen JC, Chang FJ, Chang S. A New Criterion for 
      Automatic Multilevel Thresholding. <i>IEEE Transactions on Image 
      Processing</i>. 1995;4(3):370-378. doi:10.1109/83.366472"
      line2 <- "[17] Sezgin M, Sankur B. Survey over Image 
      Thresholding Techniques and Quantitative Performance Evaluation. 
      <i>Journal of Electronic Imaging</i>. 2004;13(1):146-165."
      HTML(paste(line1, line2, sep = '<br/>'))
    }
```
<br>

Report generated using tryBASIN Shiny app version 1.0.0. Copyright (c) 2021 Bioinformatics and Computational Bioengineering Group (BiCBioEng), and The University of South Dakota. All rights reserved. For more information, visit the BASIN project at [https://basin-v10.readthedocs.io/en/latest/#](https://basin-v10.readthedocs.io/en/latest/#) or see our YouTube tutorials at [https://www.youtube.com/watch?v=Co-ejU11n08&list=PLgWMllLGp9XgE8oKFdCoV3qtbpTxRucdh](https://www.youtube.com/watch?v=Co-ejU11n08&list=PLgWMllLGp9XgE8oKFdCoV3qtbpTxRucdh).